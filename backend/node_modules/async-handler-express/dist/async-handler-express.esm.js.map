{"version":3,"file":"async-handler-express.esm.js","sources":["../src/catchAsync.ts","../src/ErrorClass.ts","../src/handler.ts","../src/index.ts"],"sourcesContent":["import Express from 'express';\ninterface callback {\n  (\n    req: Express.Request,\n    res: Express.Response,\n    next: Express.NextFunction\n  ): void;\n}\n\nexport const catchAsync = (fn: callback) => (\n  req: Express.Request,\n  res: Express.Response,\n  next: Express.NextFunction\n) => {\n  Promise.resolve(fn(req, res, next)).catch(err => next(err));\n};\n","class ErrorClass extends Error {\n  constructor(\n    public statusCode: number,\n    public message: string,\n    public isOperational: Boolean = true,\n    public stack = ''\n  ) {\n    super(message);\n    this.statusCode = statusCode;\n    this.isOperational = isOperational;\n    if (stack) {\n      this.stack = stack;\n    } else {\n      Error.captureStackTrace(this, this.constructor);\n    }\n  }\n}\n\nexport default ErrorClass;\n","import Express from 'express';\nimport httpStatus from 'http-status';\nimport ApiError from './ErrorClass';\n\n\n\nexport const errorHandler = (\n  err: any,\n  _req: Express.Request,\n  res: Express.Response,\n  _next: Express.NextFunction\n) => {\n\n  let error = err;\n  if (!(error instanceof ApiError)) {\n    const statusCode = error.statusCode || httpStatus.BAD_REQUEST;\n    const message = error.message || httpStatus[statusCode];\n    error = new ApiError(statusCode, message, false, err.stack);\n  }\n  if (process.env.NODE_ENV === 'production' && !err.isOperational) {\n    error.statusCode = httpStatus.INTERNAL_SERVER_ERROR;\n    error.message = httpStatus[httpStatus.INTERNAL_SERVER_ERROR];\n  }\n\n  res.locals.errorMessage = error.message;\n\n  const response = {\n    code: error.statusCode,\n    message: error.message,\n    ...(process.env.NODE_ENV === 'development' && { stack: error.stack }),\n  };\n\n  res.status(error.statusCode).send(response);\n};\n","export { catchAsync } from './catchAsync';\nexport { errorHandler } from './handler';\n\nexport const asyncHandle = function (fn: Function) {\n  Promise.resolve(fn(arguments)).catch(() => {\n    return 'err';\n  });\n};\n"],"names":["catchAsync","fn","req","res","next","Promise","resolve","err","ErrorClass","statusCode","message","isOperational","stack","Error","captureStackTrace","constructor","errorHandler","_req","_next","error","ApiError","httpStatus","BAD_REQUEST","process","env","NODE_ENV","INTERNAL_SERVER_ERROR","locals","errorMessage","response","code","status","send","asyncHandle","arguments"],"mappings":";;IASaA,UAAU,GAAG,SAAbA,UAAa,CAACC,EAAD;EAAA,OAAkB,UAC1CC,GAD0C,EAE1CC,GAF0C,EAG1CC,IAH0C;IAK1CC,OAAO,CAACC,OAAR,CAAgBL,EAAE,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,CAAlB,WAA0C,UAAAG,GAAG;MAAA,OAAIH,IAAI,CAACG,GAAD,CAAR;KAA7C;GALwB;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICTpBC;;;EACJ,oBACSC,UADT,EAESC,OAFT,EAGSC,aAHT,EAISC,KAJT;;;QAGSD;MAAAA,gBAAyB;;;QACzBC;MAAAA,QAAQ;;;IAEf,0BAAMF,OAAN;IALO,gBAAA,GAAAD,UAAA;IACA,aAAA,GAAAC,OAAA;IACA,mBAAA,GAAAC,aAAA;IACA,WAAA,GAAAC,KAAA;IAGP,MAAKH,UAAL,GAAkBA,UAAlB;IACA,MAAKE,aAAL,GAAqBA,aAArB;;IACA,IAAIC,KAAJ,EAAW;MACT,MAAKA,KAAL,GAAaA,KAAb;KADF,MAEO;MACLC,KAAK,CAACC,iBAAN,gCAA8B,MAAKC,WAAnC;;;;;;;iCAbmBF;;ICMZG,YAAY,GAAG,SAAfA,YAAe,CAC1BT,GAD0B,EAE1BU,IAF0B,EAG1Bd,GAH0B,EAI1Be,KAJ0B;EAO1B,IAAIC,KAAK,GAAGZ,GAAZ;;EACA,IAAI,EAAEY,KAAK,YAAYC,UAAnB,CAAJ,EAAkC;IAChC,IAAMX,UAAU,GAAGU,KAAK,CAACV,UAAN,IAAoBY,UAAU,CAACC,WAAlD;IACA,IAAMZ,OAAO,GAAGS,KAAK,CAACT,OAAN,IAAiBW,UAAU,CAACZ,UAAD,CAA3C;IACAU,KAAK,GAAG,IAAIC,UAAJ,CAAaX,UAAb,EAAyBC,OAAzB,EAAkC,KAAlC,EAAyCH,GAAG,CAACK,KAA7C,CAAR;;;EAEF,IAAIW,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,IAAyC,CAAClB,GAAG,CAACI,aAAlD,EAAiE;IAC/DQ,KAAK,CAACV,UAAN,GAAmBY,UAAU,CAACK,qBAA9B;IACAP,KAAK,CAACT,OAAN,GAAgBW,UAAU,CAACA,UAAU,CAACK,qBAAZ,CAA1B;;;EAGFvB,GAAG,CAACwB,MAAJ,CAAWC,YAAX,GAA0BT,KAAK,CAACT,OAAhC;;EAEA,IAAMmB,QAAQ;IACZC,IAAI,EAAEX,KAAK,CAACV,UADA;IAEZC,OAAO,EAAES,KAAK,CAACT;KACXa,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,IAA0C;IAAEb,KAAK,EAAEO,KAAK,CAACP;GAHjD,CAAd;;EAMAT,GAAG,CAAC4B,MAAJ,CAAWZ,KAAK,CAACV,UAAjB,EAA6BuB,IAA7B,CAAkCH,QAAlC;AACD,CA3BM;;ICHMI,WAAW,GAAG,SAAdA,WAAc,CAAUhC,EAAV;EACzBI,OAAO,CAACC,OAAR,CAAgBL,EAAE,CAACiC,SAAD,CAAlB,WAAqC;IACnC,OAAO,KAAP;GADF;AAGD,CAJM;;;;"}